<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="google-site-verification" content="dlgd_dJjtuNNs_lShQtUtyxGA7JIhrE9iY9RXILDesU">
  <title>Trellolite</title>
  <link rel="icon" type="image/png" href="/web/favicon.png" sizes="32x32">
  <link rel="stylesheet" href="/web/styles.css">
</head>
<body>
  <!-- Верхняя шапка приложения -->
  <header class="topbar" role="banner">
    <div class="tb-left">
      <button id="btnSidebarToggle" class="btn icon" title="Свернуть панель" aria-label="Свернуть панель">
        <svg aria-hidden="true"><use href="#i-menu"></use></svg>
      </button>
      <span class="brand">Trellolite</span>
    </div>
    <div class="tb-center">
      <form class="search" role="search" aria-label="Поиск по доскам" onsubmit="return false">
        <input id="q" type="search" placeholder="Поиск" autocomplete="off">
      </form>
    </div>
    <div class="tb-right">
      <button id="btnTheme" class="btn icon" title="Переключить тему" aria-label="Переключить тему">
        <svg aria-hidden="true"><use href="#i-auto"></use></svg>
      </button>
      <!-- Меню пользователя: details обеспечивает доступность и автозакрытие -->
      <details class="usermenu" id="userMenu">
        <summary class="avatarbtn" aria-label="Меню пользователя">
          <div class="avatar" aria-hidden="true">A</div>
        </summary>
        <div class="menu-panel" role="menu" aria-label="Меню пользователя">
          <div class="group">
            <a class="item" role="menuitem" id="miProfile" href="/web/profile.html">Профиль</a>
            <a class="item" role="menuitem" id="miSettings" href="/web/settings.html">Настройки</a>
          </div>
          <div class="group">
            <a class="item" role="menuitem" id="btnAdmin" href="/web/admin.html" style="display:none">Администрирование</a>
          </div>
          <div class="group">
            <button type="button" class="item danger" role="menuitem" id="btnLogout">Выйти</button>
          </div>
        </div>
      </details>
    </div>
  </header>
  <div id="app">
  <aside class="sidebar">
      <!-- Блок userbar удален: теперь профиль в верхней шапке -->
      <div class="boards-header">
        <span>Доски</span>
        <div class="scope-toggle" role="group" aria-label="Фильтр досок">
          <button id="scopeMine" class="btn toggle" aria-pressed="true" title="Показать мои доски" aria-label="Мои">
            <svg aria-hidden="true"><use href="#i-user"></use></svg>
            <span class="lbl">Мои</span>
          </button>
          <button id="scopeGroups" class="btn toggle" aria-pressed="true" title="Показать доски из групп" aria-label="Группы">
            <svg aria-hidden="true"><use href="#i-users"></use></svg>
            <span class="lbl">Группы</span>
          </button>
        </div>
        <div class="spacer"></div>
        <button id="btnNewBoard" class="btn icon" title="Новая доска" aria-label="Новая доска"><svg aria-hidden="true"><use href="#i-plus"></use></svg></button>
      </div>
  <ul id="boards" class="boards"></ul>
      <div class="sidebar-footer">
        <button id="btnGroupsPanel" class="btn" title="Управление группами">Группы…</button>
      </div>
    </aside>
    <main class="main">
      <div id="boardHeader" class="board-header">
        <h2 id="boardTitle"></h2>
        <div class="spacer"></div>
        <a href="/privacy" class="link-privacy" title="Политика конфиденциальности">Политика</a>
        <button id="btnBoardGroups" class="btn icon" title="Доступ к доске для групп" aria-label="Доступ">
          <svg aria-hidden="true"><use href="#i-users"></use></svg>
        </button>
        <button id="btnRenameBoard" class="btn icon" title="Переименовать доску" aria-label="Переименовать">
          <svg aria-hidden="true"><use href="#i-edit"></use></svg>
        </button>
        <button id="btnDeleteBoard" class="btn icon" title="Удалить доску" aria-label="Удалить">
          <svg aria-hidden="true"><use href="#i-trash"></use></svg>
        </button>
        <button id="btnNewList" class="btn icon" title="Новый список" aria-label="Новый список">
          <svg aria-hidden="true"><use href="#i-plus"></use></svg>
        </button>
      </div>
      <div id="lists" class="lists"></div>
    </main>
  </div>

  <dialog id="dlgBoard">
    <form id="formBoard" method="dialog">
      <h3>Новая доска</h3>
      <label>Название
        <input name="title" required maxlength="200">
      </label>
      <label>Проект
        <div class="row">
          <select id="projectSelect" name="project_id"></select>
          <button id="btnNewProject" type="button" class="btn">Новый проект…</button>
        </div>
      </label>
      <menu>
  <button type="button" value="cancel" class="btn" formnovalidate>Отмена</button>
  <button value="ok" class="btn primary">Создать</button>
      </menu>
    </form>
  </dialog>

  <dialog id="dlgList">
    <form id="formList" method="dialog">
      <h3>Новый список</h3>
      <label>Название
        <input name="title" required maxlength="200">
      </label>
      <menu>
  <button type="button" value="cancel" class="btn" formnovalidate>Отмена</button>
  <button value="ok" class="btn primary">Создать</button>
      </menu>
    </form>
  </dialog>

  <dialog id="dlgCard" class="card-dialog">
    <div class="card-dialog-container">
      <div class="card-dialog-header">
        <h2>Новая карточка</h2>
        <button type="button" class="close-btn" id="btnCloseCardDialog">×</button>
      </div>
      
      <form id="formCard" class="card-form">
        <div class="form-group">
          <label for="cardTitle">Заголовок</label>
          <input type="text" id="cardTitle" name="title" required maxlength="200" placeholder="Название задачи">
        </div>
        
        <div class="form-group">
          <label for="cardDescription">Описание</label>
          <textarea id="cardDescription" name="description" rows="6" placeholder="Опишите задачу..."></textarea>
          <div class="checkbox-group">
            <label class="checkbox-label">
              <input type="checkbox" name="description_is_md">
              <span class="checkmark"></span>
              Markdown
            </label>
          </div>
        </div>
        
        <div class="form-group">
          <label for="cardDueAt">Срок</label>
          <input id="cardDueAt" name="due_at" type="text" placeholder="дд.мм.гггг чч:мм" readonly>
        </div>
        
        <div id="cardFormStatus" class="form-status"></div>
        
        <div class="form-actions">
          <button type="button" class="btn btn-secondary" id="btnCancelCardDialog">Отмена</button>
          <button type="submit" class="btn btn-primary">Создать</button>
        </div>
      </form>
    </div>
  </dialog>

  <dialog id="dlgCardView">
    <div class="dialog-body">
      <h3>Карточка</h3>
      <label>Заголовок
            <input id="cvTitle" maxlength="200" placeholder="Название">
      </label>
      <label>Описание
  <textarea id="cvDescription" rows="6" placeholder="Опишите задачу..."></textarea>
  <!-- Markdown toggle button injected by JS; preview container follows -->
      </label>
      <label>Срок
        <input id="cvDueAt" type="text" placeholder="дд.мм.гггг  чч:мм" readonly>
      </label>
      <label id="assigneeField" hidden>Исполнитель
        <select id="cvAssignee"></select>
      </label>
      <section>
        <h4>Комментарии</h4>
        <ul id="cvComments"></ul>
        <div class="add-comment">
          <input id="cvCommentText" placeholder="Написать комментарий..." maxlength="1000">
          <button id="btnAddComment" class="btn primary">Добавить</button>
        </div>
      </section>
      <menu>
        <button id="btnCloseCardView" class="btn">Закрыть</button>
        <button id="btnSaveCardView" class="btn primary">Сохранить</button>
      </menu>
    </div>
  </dialog>

  <dialog id="dlgDateTime">
    <div class="dialog-body">
      <h3>Дата и время</h3>
      <div class="dt-header">
        <button class="btn icon" id="dtPrev" title="Предыдущий месяц" aria-label="Предыдущий месяц">‹</button>
        <div class="dt-month" id="dtMonth"></div>
        <button class="btn icon" id="dtNext" title="Следующий месяц" aria-label="Следующий месяц">›</button>
      </div>
      <div class="dt-grid" id="dtGrid"></div>
      <div class="dt-time">
        <label>Часы
          <select id="dtHour"></select>
        </label>
        <label>Минуты
          <select id="dtMinute"></select>
        </label>
      </div>
      <menu>
        <button type="button" id="btnDtClear" class="btn">Сбросить</button>
        <button type="button" id="btnDtCancel" class="btn">Отмена</button>
        <button type="button" id="btnDtOk" class="btn primary">Применить</button>
      </menu>
    </div>
  </dialog>

  <dialog id="dlgConfirm">
    <form id="formConfirm" method="dialog">
      <h3>Подтверждение</h3>
      <p id="confirmMessage">Вы уверены?</p>
      <menu>
  <button id="btnConfirmCancel" class="btn" value="cancel">Отмена</button>
  <button id="btnConfirmOk" class="btn primary" value="ok">Продолжить</button>
      </menu>
    </form>
  </dialog>

  <dialog id="dlgInput">
    <form id="formInput" method="dialog">
      <h3 id="inputTitle">Ввод</h3>
      <label>
        <span id="inputLabel">Значение</span>
        <input id="inputValue" name="value" maxlength="200" required>
      </label>
      <menu>
        <button type="button" value="cancel" class="btn">Отмена</button>
        <button value="ok" class="btn primary">ОК</button>
      </menu>
    </form>
  </dialog>

  <dialog id="dlgSelect">
    <form id="formSelect" method="dialog">
      
      <label>
        <span id="selectLabel">Выберите</span>
        <select id="selectControl" name="select"></select>
      </label>
      <menu>
        <button type="button" value="cancel" class="btn">Отмена</button>
        <button value="ok" class="btn primary">Выбрать</button>
      </menu>
    </form>
  </dialog>

  <dialog id="dlgGroups">
    <form id="formGroups" method="dialog">
      <h3>Доступ доски для групп</h3>
      <div id="groupsList" class="groups-list"></div>
      <menu>
        <button type="button" value="cancel" class="btn">Отмена</button>
        <button value="ok" class="btn primary">Сохранить</button>
      </menu>
    </form>
  </dialog>

  <dialog id="dlgMembers">
    <form id="formMembers" method="dialog">
      <h3>Участники группы</h3>
  <div class="field"><input id="userSearch" placeholder="Поиск пользователя по имени"></div>
  <div id="membersStatus"></div>
      <div id="membersList" class="groups-list"></div>
      <menu>
        <button value="cancel" class="btn">Закрыть</button>
      </menu>
    </form>
  </dialog>

  <dialog id="dlgGroupsPanel">
    <form id="formGroupsPanel" method="dialog">
      <h3>Группы</h3>
      <div id="groupsPanelList" class="groups-list"></div>
      <menu>
        <button type="button" value="cancel" class="btn">Закрыть</button>
      </menu>
    </form>
  </dialog>

  <dialog id="dlgColor">
    <form id="formColor" method="dialog">
      <h3>Цвет</h3>
      <div class="color-grid">
        <button type="button" class="swatch" data-color="" title="Без цвета"></button>
        <button type="button" class="swatch" data-color="#ef4444" style="--c:#ef4444" title="Красный"></button>
        <button type="button" class="swatch" data-color="#f59e0b" style="--c:#f59e0b" title="Оранжевый"></button>
        <button type="button" class="swatch" data-color="#10b981" style="--c:#10b981" title="Зелёный"></button>
        <button type="button" class="swatch" data-color="#3b82f6" style="--c:#3b82f6" title="Синий"></button>
        <button type="button" class="swatch" data-color="#8b5cf6" style="--c:#8b5cf6" title="Фиолетовый"></button>
        <button type="button" class="swatch" data-color="#ec4899" style="--c:#ec4899" title="Розовый"></button>
        <button type="button" class="swatch" data-color="#14b8a6" style="--c:#14b8a6" title="Бирюзовый"></button>
        <button type="button" class="swatch" data-color="#f43f5e" style="--c:#f43f5e" title="Малиновый"></button>
      </div>
      <label>Произвольный цвет
        <input id="colorCustom" type="color" value="#3b82f6">
      </label>
      <menu>
  <button type="button" value="clear" class="btn">Сбросить</button>
  <button value="ok" class="btn primary">Применить</button>
      </menu>
    </form>
  </dialog>

  <!-- SVG sprite for icons -->
  <svg xmlns="http://www.w3.org/2000/svg" style="display:none">
    <symbol id="i-trash" viewBox="0 0 24 24" fill="currentColor">
      <path d="M9 3h6a1 1 0 0 1 1 1v1h4a1 1 0 1 1 0 2h-1.05l-1.03 12.36A3 3 0 0 1 14.93 23H9.07a3 3 0 0 1-2.99-2.64L5.05 7H4a1 1 0 1 1 0-2h4V4a1 1 0 0 1 1-1Zm1 3h4V5h-4v1Zm-2.94 1 1 12a1 1 0 0 0 1 .92h5.88a1 1 0 0 0 1-.92l1-12H7.06Z"/>
    </symbol>
    <symbol id="i-sun" viewBox="0 0 24 24" fill="currentColor">
      <path d="M12 18a6 6 0 1 0 0-12 6 6 0 0 0 0 12Zm0 4a1 1 0 0 1-1-1v-1.5a1 1 0 1 1 2 0V21a1 1 0 0 1-1 1Zm0-20a1 1 0 0 1 1 1v1.5a1 1 0 1 1-2 0V3a1 1 0 0 1 1-1Zm10 9a1 1 0 0 1 1 1 1 1 0 0 1-1 1h-1.5a1 1 0 1 1 0-2H22ZM3.5 11a1 1 0 1 1 0 2H2a1 1 0 1 1 0-2h1.5ZM18.364 5.636a1 1 0 1 1 1.414 1.414l-1.06 1.06a1 1 0 1 1-1.415-1.414l1.06-1.06Zm-12.02 12.02a1 1 0 1 1-1.414-1.415l1.06-1.06a1 1 0 1 1 1.415 1.414l-1.06 1.06ZM5.636 5.636a1 1 0 1 1 1.414-1.414l1.06 1.06A1 1 0 0 1 6.695 6.7l-1.06-1.06Zm12.02 12.02a1 1 0 1 1-1.414 1.414l-1.06-1.06a1 1 0 1 1 1.414-1.414l1.06 1.06Z"/>
    </symbol>
    <symbol id="i-moon" viewBox="0 0 24 24" fill="currentColor">
      <path d="M21 12.79A9 9 0 1 1 11.21 3a7 7 0 1 0 9.79 9.79Z"/>
    </symbol>
    <symbol id="i-auto" viewBox="0 0 24 24" fill="currentColor">
      <path d="M12 2a10 10 0 1 0 8.66 5l-2.31.77A7.5 7.5 0 1 1 6.23 6.23L7 3.92A10 10 0 0 0 12 2Z"/>
    </symbol>
    <symbol id="i-grip" viewBox="0 0 24 24" fill="currentColor">
      <path d="M7 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Zm0 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Zm0 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Zm10-12a1 1 0 1 0 0-2 1 1 0 0 0 0 2Zm0 6a1 1 0 1 0 0-2 1 1 0 0 0 0 2Zm0 6a1 1 0 1 0 0-2 1 1 0 0 0 0 2Z"/>
    </symbol>
    <symbol id="i-board" viewBox="0 0 24 24" fill="currentColor">
      <path d="M4 4h16a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2Zm0 2v12h5V6H4Zm7 0v12h9V6h-9Z"/>
    </symbol>
    <symbol id="i-card" viewBox="0 0 24 24" fill="currentColor">
      <path d="M5 4h14a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2Zm0 4v10h14V8H5Zm2 2h8a1 1 0 1 1 0 2H7a1 1 0 1 1 0-2Z"/>
    </symbol>
    <symbol id="i-palette" viewBox="0 0 24 24" fill="currentColor">
      <path d="M12 2a10 10 0 1 0 0 20h.5a2.5 2.5 0 0 0 0-5H11a1 1 0 0 1-1-1 3 3 0 0 1 3-3h2a5 5 0 0 0 0-10H12Zm-5 9a1.5 1.5 0 1 1 0-3 1.5 1.5 0 0 1 0 3Zm4-4a1.5 1.5 0 1 1 0-3 1.5 1.5 0 0 1 0 3Zm6 2a1.5 1.5 0 1 1 0-3 1.5 1.5 0 0 1 0 3Zm-2 4a1.5 1.5 0 1 1 0-3 1.5 1.5 0 0 1 0 3Z"/>
    </symbol>
    <!-- New icons -->
    <symbol id="i-plus" viewBox="0 0 24 24" fill="currentColor">
      <path d="M11 11V5a1 1 0 1 1 2 0v6h6a1 1 0 1 1 0 2h-6v6a1 1 0 1 1-2 0v-6H5a1 1 0 1 1 0-2h6Z"/>
    </symbol>
    <symbol id="i-edit" viewBox="0 0 24 24" fill="currentColor">
      <path d="M3 17.25V21h3.75L19.81 7.94l-3.75-3.75L3 17.25Zm18.71-11.04a1.003 1.003 0 0 0 0-1.42l-2.5-2.5a1.003 1.003 0 0 0-1.42 0l-1.83 1.83 3.75 3.75 1.99-1.66Z"/>
    </symbol>
    <symbol id="i-user" viewBox="0 0 24 24" fill="currentColor">
      <path d="M12 12a5 5 0 1 0-5-5 5 5 0 0 0 5 5Zm0 2c-4.42 0-8 2.24-8 5v1a1 1 0 0 0 1 1h14a1 1 0 0 0 1-1v-1c0-2.76-3.58-5-8-5Z"/>
    </symbol>
    <symbol id="i-users" viewBox="0 0 24 24" fill="currentColor">
      <path d="M16 11a4 4 0 1 0-4-4 4 4 0 0 0 4 4Zm-8 3a4 4 0 1 0-4-4 4 4 0 0 0 4 4Zm8 2c-3.31 0-6 1.79-6 4v1a1 1 0 0 0 1 1h10a1 1 0 0 0 1-1v-1c0-2.21-2.69-4-6-4Zm-8 0c-3.31 0-6 1.79-6 4v1a1 1 0 0 0 1 1h6v-1c0-1.52.84-2.86 2.19-3.83A9.26 9.26 0 0 0 8 16Z"/>
    </symbol>
    <!-- Collapse/Expand chevrons and menu icon -->
    <symbol id="i-menu" viewBox="0 0 24 24" fill="currentColor">
      <path d="M4 6h16v2H4zM4 11h16v2H4zM4 16h16v2H4z"/>
    </symbol>
    <symbol id="i-chevr-left" viewBox="0 0 24 24" fill="currentColor">
      <path d="M15.41 7.41 14 6l-6 6 6 6 1.41-1.41L10.83 12l4.58-4.59Z"/>
    </symbol>
    <symbol id="i-chevr-right" viewBox="0 0 24 24" fill="currentColor">
      <path d="M8.59 16.59 10 18l6-6-6-6-1.41 1.41L13.17 12l-4.58 4.59Z"/>
    </symbol>
  </svg>
  <!-- Markdown icon -->
  <svg xmlns="http://www.w3.org/2000/svg" style="display:none">
    <symbol id="i-markdown" viewBox="0 0 24 24" fill="currentColor">
      <path d="M4 5h16a1 1 0 0 1 1 1v12a1 1 0 0 1-1 1H4a1 1 0 0 1-1-1V6a1 1 0 0 1 1-1Zm1 2v10h14V7H5Zm2 8V9h2l2 3 2-3h2v6h-2v-3l-2 3-2-3v3H7Z"/>
    </symbol>
  </svg>

  <script src="/web/app.js" defer></script>
</body>
</html>
